# 使用iSCSI服务部署网络存储

硬盘接口类型主要有IDE、SCSI和SATA

* IDE是一种成熟稳定、价格便宜的并行传输接口。
* SATA是一种传输速度更快、数据校验更完整的串行传输接口。 
* SCSI是一种用于计算机和硬盘、光驱等设备之间系统级接口的通用标准，具有系统资源占用率低、转速高、传输速度快等优点。


## 创建RAID磁盘阵列

    添加4块新硬盘，用于创建RAID 5磁盘阵列和备份盘
    


## iSCSI技术在工作形式上分为服务端（target）与客户端（initiator）。
    iSCSI服务端即用于存放硬盘存储资源的服务器，它作为前面创建的RAID磁盘阵列的存储端，
    能够为用户提供可用的存储资源。iSCSI客户端则是用户使用的软件，用于访问远程服务端的存储资源。


    [root@localhost ~]# mdadm -Cv /dev/md0 -n 3 -l 5 -x 1 /dev/sdb /dev/sdc /dev/sdd /dev/sde
    
    [root@localhost ~]# lsblk 
    NAME            MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINT
    sda               8:0    0   40G  0 disk  
    ├─sda1            8:1    0  600M  0 part  /boot
    └─sda2            8:2    0 39.4G  0 part  
      ├─centos-root 253:0    0 37.4G  0 lvm   /
      └─centos-swap 253:1    0    2G  0 lvm   [SWAP]
    sdb               8:16   0   20G  0 disk  
    └─md0             9:0    0   40G  0 raid5 
    sdc               8:32   0   20G  0 disk  
    └─md0             9:0    0   40G  0 raid5 
    sdd               8:48   0   20G  0 disk  
    └─md0             9:0    0   40G  0 raid5 
    sde               8:64   0   20G  0 disk  
    └─md0             9:0    0   40G  0 raid5 
    sr0              11:0    1 1024M  0 rom 
        
    [root@localhost ~]# mdadm -D /dev/md0
    /dev/md0:
               Version : 1.2
         Creation Time : Mon Feb 11 19:11:50 2019
            Raid Level : raid5
            Array Size : 41908224 (39.97 GiB 42.91 GB)
         Used Dev Size : 20954112 (19.98 GiB 21.46 GB)
          Raid Devices : 3
         Total Devices : 4
           Persistence : Superblock is persistent
    
           Update Time : Mon Feb 11 19:12:56 2019
                 State : clean 
        Active Devices : 3
       Working Devices : 4
        Failed Devices : 0
         Spare Devices : 1
    
                Layout : left-symmetric
            Chunk Size : 512K
    
    Consistency Policy : resync
    
                  Name : localhost.localdomain:0  (local to host localhost.localdomain)
                  UUID : b4b2db91:e75feb5b:a4a007ec:128f0def
                Events : 18
    
        Number   Major   Minor   RaidDevice State
           0       8       16        0      active sync   /dev/sdb
           1       8       32        1      active sync   /dev/sdc
           4       8       48        2      active sync   /dev/sdd
    
           3       8       64        -      spare   /dev/sde
           


__第1步：配置好Yum软件仓库后安装iSCSI服务端程序以及配置命令工具__
        
        yum -y install targetd targetcli
        
        安装完成后启动iSCSI的服务端程序targetd，然后把这个服务程序加入到开机启动项中，以便下次在服务器重启后依然能够为用户提供iSCSI共享存储资源服务：
        [root@localhost ~]# systemctl start targetd
        [root@localhost ~]# systemctl enable targetd
        
        
第2步：配置iSCSI服务端共享资源。targetcli是用于管理iSCSI服务端存储资源的专用配置命令，
它能够提供类似于fdisk命令的交互式配置功能，将iSCSI共享资源的配置内容抽象成“目录”的形式，
我们只需将各类配置信息填入到相应的“目录”中即可。这里的难点主要在于认识每个“参数目录”的作用。
当把配置参数正确地填写到“目录”中后，iSCSI服务端也可以提供共享资源服务了。
        
        

        
第3步：创建iSCSI target名称及配置共享资源。
iSCSI target名称是由系统自动生成的，这是一串用于描述共享资源的唯一字符串。
稍后用户在扫描iSCSI服务端时即可看到这个字符串，因此我们不需要记住它。
系统在生成这个target名称后，还会在/iscsi参数目录中创建一个与其字符串同名的新“目录”用来存放共享资源。
我们需要把前面加入到iSCSI共享资源池中的硬盘设备添加到这个新目录中，这样用户在登录iSCSI服务端后，
即可默认使用这硬盘设备提供的共享存储资源了。



第4步：设置访问控制列表（ACL）。
iSCSI协议是通过客户端名称进行验证的，也就是说，用户在访问存储共享资源时不需要输入密码，
只要iSCSI客户端的名称与服务端中设置的访问控制列表中某一名称条目一致即可，
因此需要在iSCSI服务端的配置文件中写入一串能够验证用户信息的名称。
acls参数目录用于存放能够访问iSCSI服务端共享存储资源的客户端名称。
建议在后面追加上类似于:client的参数，这样既能保证客户端的名称具有唯一性，又非常便于管理和阅读：




 