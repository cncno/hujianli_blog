# 七、三剑客之grep

## 概念

grep (global search regular expression(RE) and print out the line,全面搜索正则表达式并把行打印出来)是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。egrep是grep的扩展，支持更多的re元字符， fgrep就是fixed grep或fast grep，它们把所有的字母都看作单词，也就是说，正则表达式中的元字符表示回其自身的字面意义，不再特殊。linux使用GNU版本的grep。它功能更强，可以通过-G、-E、-F命令行选项来使用egrep和fgrep的功能。

## 语法格式

grep [OPTION]... PATTERN [FILE]

###  选项

    grep --help
    
    [options]主要参数：
    -c：只输出匹配行的计数。
    -i：不区分大小写。
    -h：查询多文件时不显示文件名。
    -l：查询多文件时只输出包含匹配字符的文件名。
    -n：显示匹配行及 行号。
    -s：不显示不存在或无匹配文本的错误信息。
    -v：显示不包含匹配文本的所有行。
    --color=auto ：可以将找到的关键词部分加上颜色的显示。

#### 模式

* 基本正则表达式元字符：

```
. :匹配任意单个字符
[] :匹配指定范围内的字符
[^]:匹配指定范围外的任意字符
```

* 次数匹配（贪婪模式）

```
*：匹配其前的字符0，1或者多次
？：匹配其前的字符0或1次
\{m,n\}:
    \(m,\):至少m次
    \{0,n\}:至多n次
    \{m\}:m次
```

* 锚定符：

```
r..t  ：root  chroot
* 单词锚定：
\<:锚定词首：\<r..t,    \b
\>:锚定词尾：root\>
* 行首行末锚定：
^: ^root,  行首
$:    root$ 行尾
.*:  任意长度的任意字符
```

* 分组：
\(\)
\(abc\)
* 引用：

```
\1 :后向引用，引用前面的第一个左括号与与之对应的右括号中的模式所匹配到的内容

```

## 使用举例

```
dmesg |grep -n eth0
grep -E '/.{2,3}' /etc/passwd

$ grep ‘test’ d*
显示所有以d开头的文件中包含 test的行。

$ grep ‘test’ aa bb cc
显示在aa，bb，cc文件中匹配test的行。

$ grep ‘[a-z]\{5\}’ aa
显示所有包含每个字符串至少有5个连续小写字符的字符串的行。

$ grep ‘w\(es\)t.*\1′ aa
如果west被匹配，则es就被存储到内存中，并标记为1，然后搜索任意个字符(.*)，
这些字符后面紧跟着 另外一个es(\1)，找到就显示该行。
如果用egrep或grep -E，就不用”\”号进行转义，直接写成’w(es)t.*\1′就可以了。


grep -i pattern files ：不区分大小写地搜索。默认情况区分大小写，
grep -l pattern files ：只列出匹配的文件名，
grep -L pattern files ：列出不匹配的文件名，
grep -w pattern files ：只匹配整个单词，而不是字符串的一部分(如匹配’magic’，而不是’magical’)，
grep -C number pattern files ：匹配的上下文分别显示[number]行，
grep pattern1 | pattern2 files ：显示匹配 pattern1 或 pattern2 的行，
例如：grep "abc\|xyz" testfile    表示过滤包含abc或xyz的行
grep pattern1 files | grep pattern2 ：显示既匹配 pattern1 又匹配 pattern2 的行。

grep -n pattern files  即可显示行号信息

grep -c pattern files  即可查找总行数


显示/proc/meminfo文件中以大小写s开头的行；
# grep "^[sS]" /proc/meminfo
# grep -i "^s" /proc/meminfo


取出默认shell为非bash的用户；
# grep -v "bash$" /etc/passwd | cut -d: -f1
```

取掉空行

```
grep -E -v "^$|^#" /etc/httpd/conf/httpd.conf
```

查看mysql中的库

```
$(mysql -uroot -p'passwd' -e "show databases;"|egrep -v 'Database|^test|mysql|performance_schema|information_schema')
```